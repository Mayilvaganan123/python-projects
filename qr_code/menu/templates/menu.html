<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Menu</title>
  <script src="https://cdn.tailwindcss.com"> </script>
</head>
<body class="bg-gray-50 p-6">
  <h1 class="text-3xl font-bold text-center mb-8">üç¥ Menu</h1>
<form method="get" class="mb-6 text-center">
  <label for="category" class="text-lg font-semibold mr-2">Filter by Category:</label>
  <select name="category" id="category" onchange="this.form.submit()" 
          class="px-4 py-2 border rounded-xl shadow-sm bg-white hover:border-green-500 focus:outline-none focus:ring focus:ring-green-300">
    <option value="">All</option>
    {% for cat in categories %}
      <option value="{{ cat }}" {% if cat == selected_category %} selected {% endif %}>{{ cat }}</option>
    {% endfor %}
  </select>
</form>
<div>
  {% for food in foods %}
    <div style="margin-bottom: 10px;">
      <strong>{{ food.name }}</strong> - ‚Çπ{{ food.price }} <br>
      <small>Category: {{ food.category }}</small>
    </div>
  {% empty %}
    
  {% endfor %}
</div>


<form action="" method="post" id="orderform">
  {% csrf_token %}
  <div class="mb-4 text-center">
    <label class="font-semibold">Table NO:</label>
    <input type="number" name="table_no" required min="1" class="border rounded-lg p-2 w-24 text-center">
  </div>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    {% for food in items %}
    <div class="bg-white shadow-lg rounded-2xl p-4 hover:scale-105 transition food-item" data-category="{{food.category.id}}"
    data-id="{{food.id}}"
    data-name="{{food.name}}"
    data-price="{{food.price}}">
      {% if food.image %}
      <img src="{{ food.image.url }}" alt="{{ food.name }}" class="rounded-xl mb-3 w-full h-40 object-cover">
      {% endif %}
      <h2 class="text-xl font-semibold">{{ food.name }}</h2>
      <p class="text-gray-600">{{ food.description }}</p>
      <p class="font-bold text-green-600 mt-2">‚Çπ{{ food.price }}</p>
      <div class=" flex items-center justify-center gap-4 mt-4">
        <button onclick="decrease('{{food.id}}')" class="mt-3 bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600" type="button">-</button>
        <span id="qty-{{food.id}}">0</span>
        <button onclick="increase('{{food.id}}')" class="mt-3 bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600" type="button">+</button>
      </div>
    </div>
    {% endfor %}
    <button class="mt-3 bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600" type="button" onclick="checkOrder()">Check order</button>
  </div>
  <input type="hidden" name="food_list" id="food_list">
  <h2 class="text-2xl font-semibold mt-6">Food list</h2>
  <ul name="list" id="list" class="mt-3 list-disc pl-6" style="list-style: none;"></ul>
  <button type="button" class="mt-3 bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600 justify-center" onclick="submitOrder()">submit Order</button>
  </form>
  <div id="thankyou" class="hidden mt-4 text-center text-green-600 text-lg font-semibold">
  ‚úÖ Thank you! Your order has been placed successfully.
  </div>
  <script>

   function increase(id) {
      const qtyEl = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyEl.textContent);
      qtyEl.textContent = qty + 1;
    }

    function decrease(id) {
      const qtyEl = document.getElementById(`qty-${id}`);
      let qty = parseInt(qtyEl.textContent);
      if (qty > 0) {
        qtyEl.textContent = qty - 1;
      }
    }      
    function checkOrder() {
    let list = document.getElementById("list");
    list.innerHTML = "";
    let fooditems = document.querySelectorAll('.food-item');

        fooditems.forEach(item=>{
            const id = item.getAttribute('data-id');
            const name = item.getAttribute('data-name');
            const price = parseInt(item.getAttribute('data-price'));
            const qty = parseInt(document.getElementById(`qty-${id}`).textContent);
       
        if (qty>0){
        const total = qty * price;        
        let li = document.createElement("li");
        li.textContent = `${name} x ${qty} = ‚Çπ${total}`;
        list.appendChild(li);
      }
    });

}
       async function submitOrder() {
    const items = document.querySelectorAll('.food-item');
    let list = [];

    items.forEach(item => {
      const id = item.dataset.id;
      const name = item.dataset.name;
      const qty = parseInt(document.getElementById(`qty-${id}`).textContent);
      if (qty > 0) {
        list.push(`${name} √ó ${qty}`);
      }
    });

    const tableNo = document.querySelector('input[name="table_no"]').value;

    if (!tableNo || list.length === 0) {
      alert("Please select items and enter your table number.");
      return;
    }

    const formData = new FormData();
    formData.append("csrfmiddlewaretoken", document.querySelector('[name=csrfmiddlewaretoken]').value);
    formData.append("table_no", tableNo);
    formData.append("food_list", list.join(", "));

    const response = await fetch("{% url 'submit_order' %}", {
      method: "POST",
      body: formData,
    });

    const result = await response.json();
    if (result.success) {
      document.getElementById('thankyou').classList.remove('hidden');
      document.getElementById('orderform').reset();

      document.querySelectorAll("[id^='qty-']").forEach(el => el.textContent = "0");
    }
  }

</script>
</body>
</html>
